<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>

<body>
<input id="name" type="text" placeholder="昵称">
<button id="conn">连接</button>&emsp;<span id="status">未连接</span>
<button id="disconn">断开</button>
<br>
<textarea id="content"></textarea>
<button id="send">发送</button>
<br>
<div id="result" style="max-height: 400px;overflow-y: scroll;box-shadow:0 0 3px gray;border-radius: 0.5rem;padding: 0.5rem">

</div>
</body>

<script>
    let ws
    document.getElementById("conn").onclick = function () {
        ws = new WebSocket("ws://localhost:8083/ws/chat?name=" + document.getElementById("name").value)
        document.getElementById("status").innerText = '已连接'
        ws.onclose = ev => {
            document.getElementById("status").innerText = '未连接'
        }
        ws.onerror = ev => {
            console.log(ev)
            document.getElementById("status").innerText = '错误'
        }
        ws.onmessage = ev => {
            document.getElementById("result").innerText += '\n' + ev.data
            document.getElementById("result").scrollTo(0, document.getElementById("result").scrollHeight)
            console.log(ev)
        }
        console.log(ws)
    }
    document.getElementById("disconn").onclick = function () {
        ws.close()
    }
    document.getElementById("content").onkeydown = ev => {
        if (ev.code === 'Enter') {
            send()
        }
    }
    document.getElementById("content").onkeyup = ev => {
        if (ev.code === 'Enter') {
            document.getElementById("content").value = ''
        }
    }
    document.getElementById("send").onclick = function () {
        send()
        document.getElementById("content").value = ''
    }
    function send(){
        let msg = document.getElementById("content").value
        if (msg === '') {
            return
        }
        console.log(msg);
        ws.send(msg)
    }
</script>
</html>